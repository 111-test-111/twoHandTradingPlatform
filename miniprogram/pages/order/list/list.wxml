<wxs module="statusUtils">
function getStatusText(status) {
  var statusMap = {
    'pending': 'å¾…ç¡®è®¤',
    'accepted': 'å·²ç¡®è®¤',
    'paid': 'å¾…æ”¶æ¬¾ç¡®è®¤',
    'completed': 'å·²å®Œæˆ',
    'cancelled': 'å·²å–æ¶ˆ',
    'rejected': 'å·²æ‹’ç»'
  };
  return statusMap[status] || 'æœªçŸ¥çŠ¶æ€';
}

module.exports = {
  getStatusText: getStatusText
};
</wxs>

<view class="container">
  <!-- åŠ è½½ä¸­çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- è®¢å•åˆ—è¡¨å†…å®¹ -->
  <view class="order-list-content" wx:else>
    <!-- é¡¶éƒ¨åˆ‡æ¢åŒºåŸŸ -->
    <view class="top-section">
      <!-- ä¹°å®¶/å–å®¶æ¨¡å¼åˆ‡æ¢ -->
      <view class="mode-toggle">
        <view class="{{isBuyerMode ? 'active' : ''}}" bindtap="toggleMode">ğŸ›’ æˆ‘çš„è´­ä¹°</view>
        <view class="{{!isBuyerMode ? 'active' : ''}}" bindtap="toggleMode">ğŸ’° æˆ‘çš„å‡ºå”®</view>
      </view>
      
      <!-- çŠ¶æ€æ ‡ç­¾é¡µ -->
      <scroll-view class="tabs-scroll" scroll-x="true" enhanced="true" show-scrollbar="false">
        <view class="tabs">
          <view 
            wx:for="{{tabs}}" 
            wx:key="index" 
            class="tab {{activeTab === index ? 'active' : ''}}"
            bindtap="onTabChange"
            data-index="{{index}}">
            <text>{{item}}</text>
          </view>
        </view>
      </scroll-view>
    </view>

    <!-- è®¢å•åˆ—è¡¨ -->
    <scroll-view 
      class="orders-scroll" 
      scroll-y="true" 
      enhanced="true" 
      bindscrolltolower="onReachBottom"
      enable-back-to-top="true">
      
      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-state" wx:if="{{displayOrders.length === 0}}">
        <view class="empty-icon">ğŸ“¦</view>
        <text class="empty-title">æš‚æ— è®¢å•</text>
        <text class="empty-desc">{{isBuyerMode ? 'æ‚¨è¿˜æ²¡æœ‰è´­ä¹°è¿‡å•†å“' : 'æ‚¨è¿˜æ²¡æœ‰å–å‡ºè¿‡å•†å“'}}</text>
      </view>

      <!-- è®¢å•å¡ç‰‡åˆ—è¡¨ -->
      <view class="order-list" wx:else>
        <view 
          wx:for="{{displayOrders}}" 
          wx:key="id" 
          class="order-card">
          
          <!-- çŠ¶æ€é®ç½© -->
          <view class="status-mask {{item.status}}">
            <text class="mask-text">{{statusUtils.getStatusText(item.status)}}</text>
          </view>

          <!-- è®¢å•ä¸»å†…å®¹ -->
          <view class="order-main" bindtap="goToOrderDetail" data-id="{{item.id}}">
            <!-- å•†å“ä¿¡æ¯è¡¨æ ¼ -->
            <view class="order-product">
              <view class="product-image-container">
                <image 
                  class="product-image" 
                  src="{{item.product.images[0] || '/assets/images/placeholder.png'}}" 
                  mode="aspectFill"></image>
                
                <!-- åˆ é™¤æŒ‰é’® (ä»…åœ¨å·²å–æ¶ˆã€å·²æ‹’ç»æˆ–å·²å®ŒæˆçŠ¶æ€æ˜¾ç¤º) -->
                <view wx:if="{{item.status === 'cancelled' || item.status === 'rejected' || item.status === 'completed'}}" 
                     class="delete-btn-image" 
                     catchtap="deleteOrder" 
                     data-id="{{item.id}}">
                  <text class="delete-icon">ğŸ—‘ï¸</text>
                </view>
              </view>
              
              <view class="product-details">
                <view class="product-info-table">
                  <view class="product-info-row">
                    <text class="product-info-label">å•†å“åç§°</text>
                    <text class="product-info-value product-title">{{item.product.title}}</text>
                  </view>
                  
                  <view class="product-info-row">
                    <text class="product-info-label">ä»·æ ¼</text>
                    <text class="product-info-value product-price">Â¥{{item.product.price}}</text>
                  </view>
                  
                  <view class="product-info-row">
                    <text class="product-info-label">{{isBuyerMode ? 'å–å®¶' : 'ä¹°å®¶'}}</text>
                    <view class="product-info-value">
                      <view class="party-info">
                        <text class="party-name">{{isBuyerMode ? (item.seller.nickname || 'æœªçŸ¥ç”¨æˆ·') : (item.buyerName || item.buyer.nickname || 'æœªçŸ¥ç”¨æˆ·')}}</text>
                      </view>
                    </view>
                  </view>
                  
                  <view class="product-info-row">
                    <text class="product-info-label">è®¢å•é‡‘é¢</text>
                    <text class="product-info-value product-price">Â¥{{item.payAmount || item.product.price}}</text>
                  </view>
                </view>
              </view>
            </view>
          </view>
        </view>
      </view>

      <!-- åŠ è½½æ›´å¤š -->
      <view wx:if="{{loadingMore}}" class="loading-more">
        <view class="loading-spinner small"></view>
        <text class="loading-text">åŠ è½½æ›´å¤š...</text>
      </view>

      <!-- æ— æ›´å¤šæ•°æ® -->
      <view wx:if="{{!hasMore && displayOrders.length > 0}}" class="no-more">
        <text>â€” æ²¡æœ‰æ›´å¤šè®¢å•äº† â€”</text>
      </view>
    </scroll-view>
  </view>
</view>
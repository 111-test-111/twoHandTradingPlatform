<!--index.wxml-->
<view class="container">
  <!-- æœç´¢æ  -->
  <view class="search-header">
    <view class="search-bar">
      <view class="search-input" bindtap="onSearchTap">
        <text class="search-icon">ğŸ”</text>
        <text class="search-placeholder">æœç´¢äºŒæ‰‹å•†å“...</text>
      </view>
    </view>
  </view>

  <!-- åˆ†ç±»å¯¼èˆª -->
  <view class="category-nav">
    <scroll-view class="category-scroll" scroll-x="true" enhanced="true" show-scrollbar="false">
      <view class="category-item {{item.value === selectedCategory ? 'active' : ''}}" 
            wx:for="{{categories}}" 
            wx:key="value"
            bindtap="onCategoryTap"
            data-category="{{item.value}}">
        <text class="category-text">{{item.name}}</text>
        <text class="category-count">{{item.count}}</text>
      </view>
    </scroll-view>
  </view>

  <!-- çƒ­é—¨æ¨èå†…å®¹åŒºåŸŸ -->
  <scroll-view class="content-scroll" 
               scroll-y="true" 
               enhanced="true" 
               bindscrolltolower="loadMoreProducts">
    <view class="section popular-section">
      <view class="section-header">
        <text class="section-title">çƒ­é—¨æ¨è</text>
      </view>
      
      <view class="product-list">
        <view class="product-card {{pressedIndex == index ? 'pressed' : ''}}" 
              wx:for="{{popularProducts}}" 
              wx:key="id"
              bindtap="onProductTap"
              bindlongpress="onProductLongPress"
              bindtouchstart="onProductTouchStart"
              bindtouchend="onProductTouchEnd"
              bindtouchcancel="onProductTouchEnd"
              data-id="{{item.id}}"
              data-index="{{index}}"
              style="animation-delay: {{index * 0.05}}s">
          <image class="card-image" src="{{item.images[0] || '/assets/images/placeholder.png'}}" mode="aspectFill" lazy-load="true"></image>
          <view class="card-content">
            <view class="card-info">
              <text class="card-title">{{item.title}}</text>
              <text class="card-desc">{{item.description}}</text>
              <view class="card-meta">
                <text class="card-price">Â¥{{item.price}}</text>
                <text class="card-campus">{{item.campus}}</text>
                <text class="card-views">{{item.viewCount || 0}}æ¬¡æµè§ˆ</text>
              </view>
            </view>
            <view class="seller-info">
              <image class="seller-avatar" src="{{item.seller.avatar || '/assets/images/default-avatar.png'}}" mode="aspectFill"></image>
              <text class="seller-name">{{item.seller.nickname || 'ç”¨æˆ·'}}</text>
            </view>
          </view>
          <view class="product-badge" wx:if="{{item.status === 'sold'}}">å·²å”®å‡º</view>
        </view>
      </view>

      <!-- åŠ è½½æ›´å¤šæŒ‡ç¤ºå™¨ -->
      <view class="load-more-indicator" wx:if="{{hasMore && popularProducts.length > 0}}">
        <view class="loading-spinner" wx:if="{{loading}}"></view>
        <text class="load-text">{{loading ? 'åŠ è½½ä¸­...' : 'ä¸Šæ‹‰åŠ è½½æ›´å¤š'}}</text>
      </view>

      <!-- æ²¡æœ‰æ›´å¤šæ•°æ® -->
      <view class="no-more-data" wx:if="{{!hasMore && popularProducts.length > 0}}">
        <text class="no-more-text">å·²ç»åˆ°åº•äº†</text>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{!popularProducts.length && !loading}}">
      <view class="empty-icon">ğŸ“¦</view>
      <!-- <text class="empty-text">æš‚æ— å•†å“</text> -->
      <button class="empty-btn" bindtap="refreshData">æš‚æ— äº§å“ï¼Œåˆ·æ–°è¯•è¯•</button>
    </view>
  </scroll-view>

  <!-- åˆå§‹åŠ è½½ä¸­ -->
  <view class="loading-container" wx:if="{{loading && popularProducts.length === 0}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- å‘å¸ƒæŒ‰é’® -->
  <view class="publish-btn" bindtap="goToPublish">
    <text class="publish-icon">+</text>
  </view>
</view>

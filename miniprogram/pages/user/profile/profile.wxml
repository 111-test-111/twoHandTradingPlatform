<view class="container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- ä¸»è¦å†…å®¹ -->
  <scroll-view wx:else class="content-scroll" scroll-y="true" enhanced="true">
    <view class="content">
      <!-- ç”¨æˆ·ä¿¡æ¯å¤´éƒ¨ -->
      <view class="user-header">
        <view wx:if="{{isLogin}}" class="user-card">
          <!-- ç”¨æˆ·å¤´åƒå’ŒåŸºæœ¬ä¿¡æ¯ -->
          <view class="user-info">
            <view class="avatar-section" bindtap="previewAvatar">
              <image 
                class="avatar" 
                src="{{userInfo.avatar || '/assets/images/placeholder.png'}}" 
                mode="aspectFill"
              />
              <view wx:if="{{userInfo.isVerified}}" class="verified-badge">
                <text class="verified-icon">âœ“</text>
              </view>
            </view>
            
            <view class="user-details">
              <view class="user-name">{{userInfo.nickname || 'ç”¨æˆ·'}}</view>
              <view class="user-tags">
                <view wx:if="{{userInfo.campus}}" class="tag campus-tag">{{userInfo.campus}}</view>
                <view class="tag credit-tag">ä¿¡ç”¨ {{stats.user.creditScore || 100}}</view>
              </view>
            </view>
            
            <view class="settings-btn" bindtap="goToSettings">
              <text class="settings-icon">âš™ï¸</text>
            </view>
          </view>

          <!-- ç»Ÿè®¡æ•°æ® -->
          <view class="stats-row">
            <view class="stat-item">
              <text class="stat-number">{{stats.products.total || 0}}</text>
              <text class="stat-label">å‘å¸ƒ</text>
            </view>
            <view class="stat-item">
              <text class="stat-number">{{stats.products.sold || 0}}</text>
              <text class="stat-label">å·²å”®</text>
            </view>
            <view class="stat-item">
              <text class="stat-number">{{stats.user.buyCount || 0}}</text>
              <text class="stat-label">å·²è´­</text>
            </view>
            <view class="stat-item">
              <text class="stat-number">{{stats.products.totalViews || 0}}</text>
              <text class="stat-label">æµè§ˆ</text>
            </view>
          </view>
        </view>

        <!-- æœªç™»å½•çŠ¶æ€ -->
        <view wx:else class="login-card">
          <image class="login-avatar" src="/assets/images/placeholder.png" mode="aspectFill"/>
          <view class="login-info">
            <view class="login-title">ç™»å½•åæŸ¥çœ‹ä¸ªäººèµ„æ–™</view>
            <view class="login-desc">ç®¡ç†å•†å“ã€æŸ¥çœ‹è®¢å•ã€äº«å—æ›´å¤šæœåŠ¡</view>
            <button class="login-btn" bindtap="goToLogin">ç«‹å³ç™»å½•</button>
          </view>
        </view>
      </view>

      <!-- å¿«æ·æ“ä½œ -->
      <view wx:if="{{isLogin}}" class="quick-actions">
        <view class="action-item" bindtap="publishProduct">
          <view class="action-icon publish-icon">ğŸ“</view>
          <text class="action-text">å‘å¸ƒå•†å“</text>
        </view>
        <view class="action-item" bindtap="viewAllOrders">
          <view class="action-icon order-icon">ğŸ“¦</view>
          <text class="action-text">æˆ‘çš„è®¢å•</text>
        </view>
        <view class="action-item">
          <view class="action-icon favorite-icon">â¤ï¸</view>
          <text class="action-text">æˆ‘çš„æ”¶è—</text>
        </view>
        <view class="action-item" bindtap="viewMessages">
          <view class="action-icon message-icon">ğŸ’¬</view>
          <text class="action-text">æ¶ˆæ¯</text>
        </view>
      </view>

      <!-- æœ€è¿‘è®¢å• -->
      <view wx:if="{{isLogin && recentOrders.length > 0}}" class="recent-orders">
        <view class="section-header">
          <text class="section-title">æœ€è¿‘äº¤æ˜“</text>
          <text class="view-all" bindtap="viewAllOrders">æŸ¥çœ‹å…¨éƒ¨ ></text>
        </view>
        <view class="orders-list">
          <view 
            wx:for="{{recentOrders}}" 
            wx:key="id" 
            class="order-item"
            bindtap="viewOrder"
            data-id="{{item.id}}"
          >
            <view class="order-type {{item.type === 'buy' ? 'buy-type' : 'sell-type'}}">
              {{item.type === 'buy' ? 'è´­ä¹°' : 'å‡ºå”®'}}
            </view>
            <view class="order-info">
              <text class="order-title">{{item.productTitle || item.title}}</text>
              <text class="order-price">Â¥{{item.totalAmount || item.price}}</text>
            </view>
            <view class="order-status {{item.status}}">
              {{item.status === 'pending' ? 'å¾…å¤„ç†' : 
                item.status === 'completed' ? 'å·²å®Œæˆ' : 
                item.status === 'cancelled' ? 'å·²å–æ¶ˆ' : 'å¤„ç†ä¸­'}}
            </view>
          </view>
        </view>
      </view>

      <!-- æˆ‘çš„å•†å“ -->
      <view wx:if="{{isLogin}}" class="my-products">
        <view class="section-header">
          <text class="section-title">æˆ‘çš„å•†å“</text>
        </view>
        
        <!-- æ ‡ç­¾åˆ‡æ¢ -->
        <view class="tabs">
          <view 
            class="tab-item {{activeTab === 'published' ? 'active' : ''}}"
            bindtap="switchTab"
            data-tab="published"
          >
            å·²å‘å¸ƒ ({{stats.products.total || 0}})
          </view>
          <view 
            class="tab-item {{activeTab === 'bought' ? 'active' : ''}}"
            bindtap="switchTab"
            data-tab="bought"
          >
            å·²è´­ä¹°
          </view>
          <view 
            class="tab-item {{activeTab === 'favorites' ? 'active' : ''}}"
            bindtap="switchTab"
            data-tab="favorites"
          >
            æ”¶è—å¤¹
          </view>
        </view>

        <!-- å•†å“åˆ—è¡¨ -->
        <view class="products-grid">
          <view wx:if="{{myProducts.length === 0}}" class="empty-state">
            <view class="empty-icon">ğŸ“¦</view>
            <text class="empty-text">
              {{activeTab === 'published' ? 'è¿˜æ²¡æœ‰å‘å¸ƒå•†å“' :
                activeTab === 'bought' ? 'è¿˜æ²¡æœ‰è´­ä¹°è®°å½•' : 'è¿˜æ²¡æœ‰æ”¶è—å•†å“'}}
            </text>
            <button wx:if="{{activeTab === 'published'}}" class="empty-btn" bindtap="publishProduct">
              å‘å¸ƒç¬¬ä¸€ä¸ªå•†å“
            </button>
          </view>

          <view wx:else class="products-list">
            <view 
              wx:for="{{myProducts}}" 
              wx:key="id" 
              class="product-card"
              bindtap="viewProduct"
              data-id="{{item.id}}"
            >
              <view class="product-image-container">
                <image 
                  class="product-image" 
                  src="{{item.images[0] || '/assets/images/placeholder.png'}}" 
                  mode="aspectFill"
                  lazy-load="true"
                />
                <view wx:if="{{item.status === 'sold'}}" class="sold-mask">
                  <text class="sold-text">å·²å”®å‡º</text>
                </view>
                <view wx:if="{{activeTab === 'published'}}" class="product-actions">
                  <view 
                    class="action-btn edit-btn" 
                    catchtap="editProduct"
                    data-id="{{item.id}}"
                  >
                    ç¼–è¾‘
                  </view>
                  <view 
                    class="action-btn delete-btn" 
                    catchtap="deleteProduct"
                    data-id="{{item.id}}"
                    data-title="{{item.title}}"
                  >
                    åˆ é™¤
                  </view>
                </view>
              </view>
              
              <view class="product-info">
                <text class="product-title">{{item.title}}</text>
                <text class="product-price">Â¥{{item.price}}</text>
                <view class="product-meta">
                  <text class="product-time">{{item.createdAt}}</text>
                  <text class="product-views">{{item.viewCount || 0}}æ¬¡æµè§ˆ</text>
                </view>
              </view>
            </view>
          </view>
        </view>

        <!-- åŠ è½½æ›´å¤š -->
        <view wx:if="{{productLoading}}" class="loading-more">
          <text>åŠ è½½ä¸­...</text>
        </view>
      </view>
    </view>
  </scroll-view>
</view> 
<view class="container">
  <!-- åŠ è½½ä¸­çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- å•†å“è¯¦æƒ…å†…å®¹ -->
  <view class="detail-content" wx:if="{{!loading}}">
    <!-- å•†å“å›¾ç‰‡è½®æ’­ -->
    <view class="image-section">
      <swiper class="image-swiper" 
              indicator-dots="{{product.images.length > 1}}" 
              indicator-color="rgba(255, 255, 255, 0.5)"
              indicator-active-color="#fff"
              autoplay="false"
              circular="true"
              bindchange="onSwiperChange"
              wx:if="{{product.images && product.images.length > 0}}">
        <swiper-item wx:for="{{product.images}}" wx:key="index">
          <image class="product-image" 
                 src="{{item}}" 
                 mode="aspectFill"
                 bindtap="onImageTap"
                 data-src="{{item}}"
                 data-index="{{index}}"
                 binderror="onImageError"
                 lazy-load="true"></image>
        </swiper-item>
      </swiper>
      <!-- æ— å›¾ç‰‡æ—¶çš„å ä½ç¬¦ -->
      <view class="no-image-placeholder" wx:else>
        <image class="placeholder-image" src="/assets/images/placeholder.png" mode="aspectFit"></image>
        <text class="placeholder-text">æš‚æ— å›¾ç‰‡</text>
      </view>
      <!-- å›¾ç‰‡è®¡æ•°å™¨ -->
      <view class="image-counter" wx:if="{{product.images && product.images.length > 1}}">
        <text>{{currentImageIndex + 1}}/{{product.images.length}}</text>
      </view>
    </view>

    <!-- å•†å“åŸºæœ¬ä¿¡æ¯ -->
    <view class="product-info-card">
      <view class="price-section">
        <text class="product-price">Â¥{{product.price}}</text>
        <view class="product-status {{product.status === 'available' ? 'status-available' : 'status-sold'}}">
          {{product.status === 'available' ? 'åœ¨å”®' : 'å·²å”®å‡º'}}
        </view>
      </view>
      
      <text class="product-title">{{product.title}}</text>
      
      <!-- å•†å“æ ‡ç­¾ -->
      <view class="product-tags">
        <view class="tag condition-tag">{{product.condition}}</view>
        <view class="tag campus-tag">{{product.campus}}</view>
        <view class="tag category-tag">{{product.category}}</view>
      </view>

      <!-- æµè§ˆé‡å’Œå‘å¸ƒæ—¶é—´ -->
      <view class="product-meta-info">
        <view class="meta-item">
          <text class="meta-icon">ğŸ‘€</text>
          <text class="meta-text">{{product.viewCount || 0}}æ¬¡æµè§ˆ</text>
        </view>
        <view class="meta-item">
          <text class="meta-icon">ğŸ•’</text>
          <text class="meta-text">{{formatTime(product.createdAt)}}</text>
        </view>
      </view>
    </view>

    <!-- å•†å“è¯¦ç»†ä¿¡æ¯ -->
    <view class="detail-info-card">
      <view class="card-header">
        <text class="card-title">å•†å“è¯¦æƒ…</text>
      </view>
      
      <view class="info-list">
        <view class="info-item">
          <text class="info-label">å•†å“æè¿°</text>
          <text class="info-value description">{{product.description || 'æš‚æ— æè¿°'}}</text>
        </view>
        
        <view class="info-item">
          <text class="info-label">æˆè‰²</text>
          <text class="info-value">{{product.condition}}</text>
        </view>
        
        <view class="info-item">
          <text class="info-label">æ‰€åœ¨æ ¡åŒº</text>
          <text class="info-value">{{product.campus}}</text>
        </view>
        
        <view class="info-item">
          <text class="info-label">äº¤æ˜“æ–¹å¼</text>
          <text class="info-value">{{product.tradeMethods}}</text>
        </view>
        
        <view class="info-item" wx:if="{{product.region}}">
          <text class="info-label">äº¤æ˜“åŒºåŸŸ</text>
          <text class="info-value">{{product.region}}</text>
        </view>
        
        <view class="info-item" wx:if="{{product.category}}">
          <text class="info-label">å•†å“åˆ†ç±»</text>
          <text class="info-value">{{product.category}}</text>
        </view>
      </view>
    </view>

    <!-- å–å®¶ä¿¡æ¯å¡ç‰‡ -->
    <view class="seller-card" wx:if="{{product.seller}}">
      <view class="card-header">
        <text class="card-title">å–å®¶ä¿¡æ¯</text>
      </view>
      
      <view class="seller-info">
        <view class="seller-main">
          <image class="seller-avatar" 
                 src="{{product.seller.avatar || '/assets/images/placeholder.png'}}" 
                 mode="aspectFill"></image>
          <view class="seller-details">
            <text class="seller-name">{{product.seller.nickname || 'åŒ¿åç”¨æˆ·'}}</text>
            <view class="seller-id">ID: {{product.seller.id || product.sellerId}}</view>
            <view class="seller-credit">
              <text class="credit-label">ä¿¡ç”¨åˆ†</text>
              <text class="credit-score">{{product.seller.creditScore || 100}}</text>
            </view>
          </view>
        </view>
        
        <view class="seller-stats" wx:if="{{sellerStats}}">
          <view class="stat-item">
            <text class="stat-value">{{sellerStats.totalProducts || 0}}</text>
            <text class="stat-label">å•†å“</text>
          </view>
          <view class="stat-item">
            <text class="stat-value">{{sellerStats.soldProducts || 0}}</text>
            <text class="stat-label">å·²å”®</text>
          </view>
          <view class="stat-item">
            <text class="stat-value">{{sellerStats.positiveRate || 100}}%</text>
            <text class="stat-label">å¥½è¯„</text>
          </view>
        </view>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’®åŒºåŸŸï¼ˆéæ‹¥æœ‰è€…ï¼‰-->
    <view class="action-section" wx:if="{{!isOwner && product.status === 'available'}}">
      <view class="action-buttons">
        <button class="action-btn favorite-btn {{isFavorited ? 'favorited' : ''}}" 
                bindtap="onToggleFavorite">
          <text class="btn-icon">{{isFavorited ? 'â¤ï¸' : 'ğŸ¤'}}</text>
          <text class="btn-text">{{isFavorited ? 'å·²æ”¶è—' : 'æ”¶è—'}}</text>
        </button>
        
        <button class="action-btn contact-btn" bindtap="onContact">
          <text class="btn-icon">ğŸ’¬</text>
          <text class="btn-text">è”ç³»å–å®¶</text>
        </button>
        
        <button class="action-btn buy-btn" bindtap="onBuy">
          <text class="btn-icon">ğŸ›’</text>
          <text class="btn-text">ç«‹å³è´­ä¹°</text>
        </button>
      </view>
    </view>

    <!-- å–å®¶æ“ä½œæŒ‰é’® -->
    <view class="action-section" wx:if="{{isOwner}}">
      <view class="action-buttons owner-actions">
        <button class="action-btn edit-btn" bindtap="onEdit">
          <text class="btn-icon">âœï¸</text>
          <text class="btn-text">ç¼–è¾‘å•†å“</text>
        </button>
        
        <button class="action-btn delete-btn" bindtap="onDelete">
          <text class="btn-icon">ğŸ—‘ï¸</text>
          <text class="btn-text">åˆ é™¤å•†å“</text>
        </button>
      </view>
    </view>

    <!-- å·²å”®å‡ºçŠ¶æ€æç¤º -->
    <view class="sold-out-notice" wx:if="{{product.status === 'sold'}}">
      <view class="notice-content">
        <text class="notice-icon">ğŸ“¦</text>
        <text class="notice-text">è¯¥å•†å“å·²å”®å‡º</text>
      </view>
    </view>
  </view>
</view> 
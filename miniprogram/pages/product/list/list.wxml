<view class="container">
  <!-- å¤´éƒ¨åŒºåŸŸ -->
  <view class="header-section">
    <!-- æœç´¢æ  -->
    <view class="search-bar" wx:if="{{showSearch}}">
      <view class="search-input-wrapper">
        <text class="search-icon">ğŸ”</text>
        <input class="search-input" 
               placeholder="æœç´¢å•†å“..." 
               placeholder-class="search-placeholder"
               value="{{keyword}}"
               bindinput="onSearchInput"
               bindconfirm="onSearchConfirm"/>
      </view>
      <button class="search-btn" bindtap="onSearchConfirm">æœç´¢</button>
    </view>

    <!-- ç­›é€‰æ  -->
    <view class="filter-bar">
      <view class="filter-item {{currentFilter === 'category' ? 'active' : ''}}" 
            bindtap="onCategoryFilter">
        <text class="filter-text">åˆ†ç±»</text>
        <text class="filter-icon">â–¼</text>
      </view>
      <view class="filter-item {{currentFilter === 'price' ? 'active' : ''}}" 
            bindtap="onPriceFilter">
        <text class="filter-text">ä»·æ ¼</text>
        <text class="filter-icon">â–¼</text>
      </view>
      <view class="filter-item {{currentFilter === 'sort' ? 'active' : ''}}" 
            bindtap="onSortFilter">
        <text class="filter-text">æ’åº</text>
        <text class="filter-icon">â–¼</text>
      </view>
    </view>
  </view>

  <!-- å•†å“åˆ—è¡¨å®¹å™¨ -->
  <scroll-view class="content-scroll" 
               scroll-y="true" 
               enhanced="true"
               refresher-enabled="true"
               refresher-triggered="{{refreshing}}"
               bindrefresherrefresh="onRefresh"
               bindscrolltolower="onReachBottom">
    
    <!-- å•†å“åˆ—è¡¨ -->
    <view class="product-list" wx:if="{{products.length > 0}}">
      <view class="product-card {{pressedIndex == index ? 'pressed' : ''}}" 
            wx:for="{{products}}" 
            wx:key="id"
            bindtap="onProductTap"
            bindlongpress="onProductLongPress"
            bindtouchstart="onProductTouchStart"
            bindtouchend="onProductTouchEnd"
            data-id="{{item.id}}"
            data-index="{{index}}"
            style="animation-delay: {{index * 0.05}}s">
        
        <image class="card-image" 
               src="{{item.images[0] || '/assets/images/placeholder.png'}}" 
               mode="aspectFill" 
               lazy-load="true"></image>
        
        <view class="card-content">
          <view class="card-info">
            <text class="card-title">{{item.title}}</text>
            <text class="card-desc">{{item.description || 'æš‚æ— æè¿°'}}</text>
            
            <view class="card-meta">
              <text class="card-price">Â¥{{item.price}}</text>
              <text class="card-campus">{{item.campus}}</text>
              <text class="card-views">{{item.viewCount || 0}}æ¬¡æµè§ˆ</text>
            </view>
          </view>
          
          <view class="seller-info" wx:if="{{item.seller}}">
            <image class="seller-avatar" 
                   src="{{item.seller.avatar || '/assets/images/placeholder.png'}}" 
                   mode="aspectFill"></image>
            <text class="seller-name">{{item.seller.nickname || 'ç”¨æˆ·'}}</text>
          </view>
        </view>
        
        <!-- å•†å“çŠ¶æ€æ ‡ç­¾ -->
        <view class="product-badge" wx:if="{{item.status === 'sold'}}">å·²å”®å‡º</view>
        <view class="product-badge condition-badge" wx:if="{{item.condition}}">{{item.condition}}</view>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤šæŒ‡ç¤ºå™¨ -->
    <view class="load-more-indicator" wx:if="{{hasMore && products.length > 0}}">
      <view class="loading-spinner" wx:if="{{loading}}"></view>
      <text class="load-text">{{loading ? 'åŠ è½½ä¸­...' : 'ä¸Šæ‹‰åŠ è½½æ›´å¤š'}}</text>
    </view>

    <!-- æ²¡æœ‰æ›´å¤šæ•°æ® -->
    <view class="no-more-data" wx:if="{{!hasMore && products.length > 0}}">
      <text class="no-more-text">å·²ç»åˆ°åº•äº†</text>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{!products.length && !loading}}">
      <view class="empty-icon">ğŸ“¦</view>
      <text class="empty-text">{{keyword ? 'æœªæ‰¾åˆ°ç›¸å…³å•†å“' : 'æš‚æ— å•†å“'}}</text>
      <button class="empty-btn" bindtap="refreshData" wx:if="{{!keyword}}">åˆ·æ–°è¯•è¯•</button>
      <button class="empty-btn" bindtap="clearSearch" wx:else>æ¸…é™¤æœç´¢</button>
    </view>
  </scroll-view>

  <!-- åˆå§‹åŠ è½½ä¸­ -->
  <view class="loading-container" wx:if="{{loading && !products.length}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- æµ®åŠ¨æ“ä½œæŒ‰é’® -->
  <view class="fab-container">
    <button class="fab-btn" bindtap="goToPublish">
      <text class="fab-icon">+</text>
    </button>
  </view>
</view> 
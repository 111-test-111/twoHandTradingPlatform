<view class="container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- æ¶ˆæ¯åˆ—è¡¨ -->
  <view wx:else class="message-list">
    <!-- ç©ºçŠ¶æ€ -->
    <view wx:if="{{conversations.length === 0}}" class="empty-state">
      <view class="empty-icon">ğŸ’¬</view>
      <text class="empty-title">æš‚æ— æ¶ˆæ¯</text>
      <text class="empty-desc">ä¸å…¶ä»–ç”¨æˆ·å¼€å§‹èŠå¤©åï¼Œæ¶ˆæ¯ä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ</text>
    </view>

    <!-- ä¼šè¯åˆ—è¡¨ -->
    <view wx:else class="conversations-container">
      <view wx:for="{{conversations}}" 
            wx:key="id" 
            class="conversation-wrapper">
        <!-- å·¦æ»‘æ“ä½œåŒºåŸŸ -->
        <view class="slide-actions">
          <view class="action-btn mark-read" 
                data-id="{{item.id}}" 
                catchtap="markAsRead">
            <text class="action-icon">âœ“</text>
            <text class="action-text">è®¾ä¸ºå·²è¯»</text>
          </view>
          <view class="action-btn delete" 
                data-id="{{item.id}}" 
                data-name="{{item.otherUser.nickname || 'ç”¨æˆ·'}}"
                catchtap="confirmDeleteConversation">
            <text class="action-icon">Ã—</text>
            <text class="action-text">åˆ é™¤ä¼šè¯</text>
          </view>
        </view>
        
        <!-- ä¼šè¯å¡ç‰‡ -->
        <view class="conversation-card {{item.slideOpen ? 'slide-open' : ''}}"
              bindtap="openChat"
              data-conversation="{{item}}"
              data-index="{{index}}"
              bindtouchstart="touchStart"
              bindtouchmove="touchMove"
              bindtouchend="touchEnd">
          
          <!-- ç”¨æˆ·å¤´åƒ -->
          <image class="user-avatar" 
                 src="{{item.otherUser.avatar || '/assets/images/placeholder.png'}}" 
                 mode="aspectFill"/>
          
          <!-- æœªè¯»æ¶ˆæ¯çº¢ç‚¹ -->
          <view wx:if="{{item.unreadCount > 0}}" class="unread-badge">
            <text class="unread-count">{{item.unreadCount > 99 ? '99+' : item.unreadCount}}</text>
          </view>
          
          <!-- ä¼šè¯å†…å®¹ -->
          <view class="conversation-content">
            <view class="conversation-header">
              <text class="user-name">{{item.otherUser.nickname || 'æœªçŸ¥ç”¨æˆ·'}}</text>
              <text class="message-time">{{item.lastMessageTime}}</text>
            </view>
            <view class="message-preview">
              <text class="last-message {{item.unreadCount > 0 ? 'unread' : ''}}">
                {{item.lastMessage || '[æš‚æ— æ¶ˆæ¯]'}}
              </text>
            </view>
            <view wx:if="{{item.productInfo}}" class="product-tag">
              <text class="product-tag-text">[å•†å“] {{item.productInfo.title}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view wx:if="{{loadingMore}}" class="loading-more">
      <view class="loading-spinner small"></view>
      <text class="loading-text">åŠ è½½æ›´å¤š...</text>
    </view>
  </view>

  <!-- åˆ é™¤ç¡®è®¤å¼¹çª— -->
  <view class="delete-modal {{showDeleteModal ? 'show' : ''}}" bindtap="hideDeleteModal">
    <view class="modal-content" catchtap="">
      <view class="modal-header">
        <text class="modal-title">åˆ é™¤ä¼šè¯</text>
      </view>
      
      <view class="modal-body">
        <text class="modal-message">ç¡®å®šè¦åˆ é™¤ä¸"{{deleteTarget.name}}"çš„ä¼šè¯å—ï¼Ÿ</text>
        <text class="modal-note">åˆ é™¤åèŠå¤©è®°å½•å°†æ— æ³•æ¢å¤</text>
      </view>
      
      <view class="modal-actions">
        <button class="modal-btn cancel-btn" bindtap="hideDeleteModal">å–æ¶ˆ</button>
        <button class="modal-btn confirm-btn" bindtap="confirmDelete">åˆ é™¤</button>
      </view>
    </view>
  </view>
</view> 